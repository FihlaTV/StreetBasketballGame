{"version":3,"sources":["core/Light.js"],"names":[],"mappings":"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","file":"Light.js","sourcesContent":["import * as THREE from 'three';\r\n\r\nimport {Loop} from '../extensions/Loop';\r\nimport {defaults} from '../utils/defaults';\r\nimport {WHSObject} from './Object';\r\n\r\nclass Light extends WHSObject {\r\n  /**\r\n   * Constructing WHS.Light object.\r\n   *\r\n   * @param {Object} params - Inputed parameters.\r\n   * @param {String} type - Light type.\r\n   * @return {WHS.Light}\r\n   */\r\n  constructor(params, type) {\r\n    if (!type)\r\n      console.error('@constructor: Please specify \" type \".');\r\n\r\n    const _set = (x, y, z) => {\r\n      this.x = x;\r\n      this.y = y;\r\n      this.z = z;\r\n    };\r\n\r\n    super({\r\n      light: {\r\n        color: 0xffffff,\r\n        skyColor: 0xffffff,\r\n        groundColor: 0xffffff,\r\n\r\n        intensity: 1,\r\n        distance: 100,\r\n        angle: Math.PI / 3,\r\n        exponent: 0,\r\n        decay: 1\r\n      },\r\n\r\n      helper: false,\r\n\r\n      shadowmap: {\r\n        cast: true,\r\n\r\n        bias: 0,\r\n        radius: 1,\r\n\r\n        width: 1024,\r\n        height: 1024,\r\n\r\n        near: true,\r\n        far: 400,\r\n        fov: 60,\r\n\r\n        top: 200,\r\n        bottom: -200,\r\n        left: -200,\r\n        right: 200\r\n      },\r\n\r\n      pos: {\r\n        x: 0,\r\n        y: 0,\r\n        z: 0,\r\n        set: _set\r\n      },\r\n\r\n      rot: {\r\n        x: 0,\r\n        y: 0,\r\n        z: 0,\r\n        set: _set\r\n      },\r\n\r\n      target: {\r\n        x: 0,\r\n        y: 0,\r\n        z: 0,\r\n        set: _set\r\n      }\r\n    });\r\n\r\n    super.setParams(params);\r\n\r\n    const scope = Object.assign(this,\r\n      {\r\n        _type: type,\r\n\r\n        _light: this.__params.light,\r\n        _shadowmap: this.__params.shadowmap\r\n      });\r\n\r\n    if (defaults.debug)\r\n      console.debug(`@WHS.Light: Light ${scope._type} found.`, scope);\r\n\r\n    return scope;\r\n  }\r\n\r\n  /**\r\n   * Applying shadow & position & rotation.\r\n   *\r\n   * @param {...String} tags - Tags that defines what to do with light\r\n   * additionally.\r\n   */\r\n  wrap(...tags) {\r\n    const _scope = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        if (tags.indexOf('no-shadows') < 0) {\r\n          _scope.getNative().castShadow = this._shadowmap.cast;\r\n        }\r\n\r\n        if (tags.indexOf('no-transforms') < 0) {\r\n          _scope.position.set(\r\n            _scope.__params.pos.x,\r\n            _scope.__params.pos.y,\r\n            _scope.__params.pos.z\r\n          );\r\n\r\n          _scope.rotation.set(\r\n            _scope.__params.rot.x,\r\n            _scope.__params.rot.y,\r\n            _scope.__params.rot.z\r\n          );\r\n\r\n          if (_scope.getNative().target) {\r\n            _scope.target.set(\r\n              _scope.__params.target.x,\r\n              _scope.__params.target.y,\r\n              _scope.__params.target.z\r\n            );\r\n          }\r\n        }\r\n\r\n        tags.forEach(tag => {\r\n          _scope[tag] = true;\r\n        });\r\n\r\n        if (defaults.debug)\r\n          console.debug(`@WHS.Light: Light ${_scope._type} + ' is ready.`, _scope);\r\n\r\n        _scope.emit('ready');\r\n\r\n        resolve(_scope);\r\n      } catch (err) {\r\n        console.error(err.message);\r\n        reject();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add light to WHS.World object.\r\n   *\r\n   * @param {WHS.World} root - World, were this light will be.\r\n   * @param {...String} tags - Tags for compiling.\r\n   */\r\n  addTo(parent) {\r\n    this.parent = parent;\r\n\r\n    const _helper = this.helper,\r\n      _scope = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        _scope.parent.getScene().add(_scope.getNative());\r\n        _scope.parent.children.push(_scope);\r\n\r\n        if (_helper) _scope.parent.getScene().add(_helper);\r\n      } catch (err) {\r\n        console.error(err.message);\r\n        reject();\r\n      } finally {\r\n        if (defaults.debug) {\r\n          console.debug(\r\n            `@WHS.Camera: Camera ${_scope._type} was added to world.`,\r\n            [_scope, _scope.parent]\r\n          );\r\n        }\r\n\r\n        resolve(_scope);\r\n        _scope.emit('ready');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set shadow properties for light.\r\n   */\r\n  wrapShadow() {\r\n    return new Promise((resolve, reject) => {\r\n      const _native = this.getNative(),\r\n        _shadow = this._shadowmap;\r\n\r\n      _native.shadow.mapSize.width = _shadow.width;\r\n      _native.shadow.mapSize.height = _shadow.height;\r\n      _native.shadow.bias = _shadow.bias;\r\n      _native.shadow.radius = _shadow.radius;\r\n\r\n      const _shadowCamera = _native.shadow.camera;\r\n\r\n      _shadowCamera.near = _shadow.near;\r\n      _shadowCamera.far = _shadow.far;\r\n      _shadowCamera.fov = _shadow.fov;\r\n\r\n      _shadowCamera.left = _shadow.left;\r\n      _shadowCamera.right = _shadow.right;\r\n      _shadowCamera.top = _shadow.top;\r\n      _shadowCamera.bottom = _shadow.bottom;\r\n\r\n      resolve(this);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clone light.\r\n   */\r\n  clone() {\r\n    return new Light(this.__params, this._type).copy(this);\r\n  }\r\n\r\n  /**\r\n   * Copy light.\r\n   *\r\n   * @param {WHS.Light} source - Source object, that will be applied to this.\r\n   */\r\n  copy(source) {\r\n    this.light = source.getNative().clone();\r\n    if (source.helper) this.helper = source.helper.clone();\r\n\r\n    this.wrap();\r\n\r\n    this.position = source.position.clone();\r\n    this.rotation = source.rotation.clone();\r\n\r\n    this._type = source._type;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Remove this light from world.\r\n   */\r\n  remove() {\r\n    this.parent.getScene().remove(this.getNative());\r\n    if (source.helper) this.parent.getScene().remove(this.helper);\r\n\r\n    this.parent.children.splice(this.parent.children.indexOf(this), 1);\r\n    this.parent = null;\r\n\r\n    this.emit('remove');\r\n\r\n    return this;\r\n  }\r\n\r\n  get position() {\r\n    return this.getNative().position;\r\n  }\r\n\r\n  set position(vector3) {\r\n    return this.getNative().position.copy(vector3);\r\n  }\r\n\r\n  get rotation() {\r\n    return this.getNative().rotation;\r\n  }\r\n\r\n  set rotation(euler) {\r\n    return this.getNative().rotation.copy(euler);\r\n  }\r\n\r\n  get target() {\r\n    return this.getNative().target.position;\r\n  }\r\n\r\n  set target(vector3) {\r\n    return this.getNative().target.position.copy(vector3);\r\n  }\r\n\r\n  follow(curve, time = 1000, loop, lookAt) {\r\n    const _scope = this,\r\n      gEnd = time;\r\n\r\n    let animation = new Loop(clock => {\r\n      const u = clock.getElapsedTime() * 1000 / gEnd,\r\n        vec1 = curve.getPoint(u),\r\n        vec2 = curve.getPoint((u + 0.01) % 1);\r\n\r\n      _scope.position.set(vec1.x, vec1.y, vec1.z);\r\n\r\n      if (!lookAt) _scope.lookAt(vec2);\r\n      else if (lookAt instanceof THREE.Vector3) _scope.lookAt(lookAt);\r\n      else if (\r\n          lookAt instanceof THREE.Curve\r\n          || lookAt instanceof THREE.CurvePath\r\n        ) _scope.lookAt(lookAt.getPoint(u));\r\n    });\r\n\r\n    animation.start();\r\n\r\n    if (loop) {\r\n      setInterval(() => {\r\n        animation.stop();\r\n\r\n        animation = new Loop(clock => {\r\n          const u = clock.getElapsedtime() * 1000 / gEnd,\r\n            vec1 = curve.getPoint(u),\r\n            vec2 = curve.getPoint((u + 0.01) % 1);\r\n\r\n          _scope.position.set(vec1.x, vec1.y, vec1.z);\r\n\r\n          if (!lookAt) _scope.lookAt(vec2);\r\n          else if (lookAt instanceof THREE.Vector3) _scope.lookAt(lookAt);\r\n          else if (\r\n              lookAt instanceof THREE.Curve\r\n              || lookAt instanceof THREE.CurvePath\r\n            ) _scope.lookAt(lookAt.getPoint(u));\r\n        });\r\n\r\n        animation.start();\r\n      }, time);\r\n    } else {\r\n      setTimeout(() => {\r\n        animation.stop();\r\n      }, time);\r\n    }\r\n  }\r\n}\r\n\r\nexport {\r\n  Light\r\n};\r\n"]}